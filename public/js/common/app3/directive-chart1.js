/*! (C) 2017 https://github.com/ikarus512 */!function(){"use strict";angular.module("myapp").directive("chart1",[function(){return{restrict:"E",scope:{data:"="},link:function(t,a,e){function r(t,a,e,r){var n=e,i=r-40-30,o={left:Math.floor(.1*n),top:Math.floor(.03*i)+40,right:Math.floor(.9*n),bottom:Math.floor(.86*i)+40},l=(d3.format("$,.2f"),d3.timeFormat("%Y-%b-%d %H:%M:%S"),d3.select(t).attr("class","chart1-container"));l.selectAll("*").remove();var c=l.append("div").attr("class","chart1-tooltip"),s=l.append("svg").attr("class","chart1-chart").attr("width","100%").attr("height",r).attr("viewBox","0 0 "+e+" "+r).style("min-width","200px"),d=s.append("g").attr("class","chart1-chart");s.append("text").attr("class","chart1-title").attr("x",e/2+"px").attr("y","40px").attr("text-ancor","middle").text(a.title),s.append("text").attr("class","chart1-note").attr("x",e/2+"px").attr("y",r-15+"px").attr("text-ancor","middle").text(a.note);return function(t){t.x.length,Math.ceil((o.right-o.left)/t.x.length);d.selectAll("g").remove();var a,e=d3.scaleTime().domain(d3.extent(t.x)).range([o.left,o.right]),r=[];for(a in t.stocks)r.push(t.stocks[a]);var n=d3.scaleLinear().domain([d3.min(r,function(t){return d3.min(t.values,function(t){return t.y})}),d3.max(r,function(t){return d3.max(t.values,function(t){return t.y})})]).range([o.bottom,o.top]),i=d3.scaleOrdinal(d3.schemeCategory10).domain(["stock1","stock2","stock3","stock4","stock5"]),l=d3.axisBottom(e).tickSize(1,1).tickFormat(d3.timeFormat("%M:%S"));d.append("g").attr("id","xAxis").attr("transform","translate(0,"+o.bottom+")").call(l).selectAll("text").attr("class","chart1-axis-x-text").attr("transform","translate(-8,0) rotate(-70)"),d.append("g").attr("id","verticalGrid").selectAll("line").data(e.ticks(5)).enter().append("line").attr("class","vertical-grid-line").attr("x1",function(t){return Math.floor(e(t))}).attr("x2",function(t){return Math.floor(e(t))}).attr("y1",o.top).attr("y2",o.bottom).attr("stroke","black").attr("stroke-width","1px");var s=d3.axisLeft(n).ticks(10).tickFormat(d3.format(".0f")).tickSize(1,1);d.append("g").attr("id","yAxis").attr("transform","translate("+o.left+",0)").call(s).selectAll("text").attr("class","chart1-axis-y-text").style("text-anchor","end"),d.append("g").attr("id","horizontalGrid").selectAll("line").data(n.ticks(10)).enter().append("line").attr("class","horizontal-grid-line").attr("x1",o.left).attr("x2",o.right).attr("y1",function(t){return Math.floor(n(t))}).attr("y2",function(t){return Math.floor(n(t))}).attr("stroke","black").attr("stroke-width","1px");var u=0,p=d3.line().curve(d3.curveLinear).x(function(t){return e(t.x)}).y(function(t){return n(t.y)}),h=d.selectAll(".stock").data(r).enter().append("g").attr("class","stock");h.append("path").attr("class","chart1-line").attr("d",function(t){return p(t.values)}).style("stroke",function(t){return i(t.id)}).attr("stroke-linejoin","round").attr("stroke-linecap","round").attr("stroke-width",3).attr("fill","none").on("mouseover",function(t){u++,d3.select(this).attr("opacity","0.5"),c.html("<div><b>"+t.id+" </b><div>").style("color",i(t.id)).style("left",d3.event.pageX+10+"px").style("top",d3.event.pageY-20+"px").style("display","block")}).on("mouseout",function(){d3.select(this).attr("opacity","1"),setTimeout(function(){0==--u&&c.style("display","none")},2e3)}),h.append("text").attr("class","chart1-label").datum(function(t){return{id:t.id,value:t.values[t.values.length-1]}}).attr("x",10).attr("transform",function(t){return"translate("+e(t.value.x)+","+n(t.value.y)+")"}).text(function(t){if("initialZeroLine"!==t.id)return t.id})}}var n=Math.max(200,a[0].getBoundingClientRect().height),i=Math.max(300,a[0].getBoundingClientRect().height),o=r(a[0],t.data,n,i);t.$watchGroup([function(){return a[0].getBoundingClientRect().width}],function(e,l){var c=Number(e[0]);isFinite(c)&&(c>=200&&(n=c),o=r(a[0],t.data,n,i))}),t.$watch("data.data",function(t,a){o&&o(t)},!0)}}}])}();