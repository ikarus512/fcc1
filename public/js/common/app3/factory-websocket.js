/*! (C) 2017 https://github.com/ikarus512 */!function(){"use strict";angular.module("app3").factory("App3WebSocketService",["App3RestService","MyError","MyConst","$q",function(e,t,n,c){var o={},a=null;return o.open=function(){var r=c.defer();return a||((a=new WebSocket(n.webSocketHost)).onopen=function(n){e.getWsTicket().then(function(e){var t="object"==typeof e&&e.data&&e.data.ticket?e.data.ticket:"";setTimeout(function(){a.send(JSON.stringify({msgtype:"app3-check-ticket",ticket:t})),r.resolve(1)},1500)}).catch(function(e){r.reject(0),t.log(e)})},a.onerror=function(e){r.reject(0)},a.onclose=function(e){r.reject(0)},a.onmessage=function(e){var t=JSON.parse(e.data);o.callback&&"app3-stocks-data"===t.msgtype&&o.callback(t.data)}),r.promise},o.subscribe=function(e){return o.callback=e,o.open()},o.addStockName=function(e){a&&a.send(JSON.stringify({msgtype:"app3-add-stock-name",stockName:e}))},o.removeStockName=function(e){a&&a.send(JSON.stringify({msgtype:"app3-remove-stock-name",stockName:e}))},o.close=function(){a&&(a.close(),a=null)},o}])}();