/*! (C) 2017 https://github.com/ikarus512 */!function(){"use strict";angular.module("myapp").controller("ControllerPoll",["$scope","$location","$window","StoragePoll","MyError","$routeParams","MyConst","User","backendParams",function(n,t,e,o,l,i,a,p,r){function c(){n.ajaxLoadingSpinner++,o.get(n.pollId).then(function(t){n.poll=t.data,n.chartOptions.title.text=n.poll.title,n.chartLabels=[],n.chartData=[],n.poll.options.forEach(function(t){n.chartLabels.push(t.title),n.chartData.push(t.votes.length)})}).catch(function(n){l.alert(n)}).finally(function(){n.ajaxLoadingSpinner--})}a.webApp?(n.logintype=r.logintype&&"undefined"!==r.logintype?r.logintype:"",n.username=r.username&&"undefined"!==r.username?r.username:"",n.pollId=r.pollId&&"undefined"!==r.pollId?r.pollId:""):(p.check().then(function(){n.logintype=p.type,n.username=p.name}),n.pollId=i.pollId),n.urlPrefix=a.urlPrefix,n.view="poll",n.newOptionTitle="",n.ajaxLoadingSpinner=0,n.poll=null,n.chartLabels=[],n.chartData=[],n.chartOptions={title:{display:!0,text:void 0},legend:{display:!0,position:"bottom"}},c(),n.pollDelete=function(){confirm("Do you really want to delete the poll?")&&(n.ajaxLoadingSpinner++,o.delete(n.poll._id).then(function(n){e.location.href=a.urlPrefix+"/app1/polls"}).catch(function(n){l.alert(n)}).finally(function(){n.ajaxLoadingSpinner--}))},n.newOptionMode=function(){n.view="newOption"},n.newOptionCancel=function(){n.newOptionTitle="",n.view="poll"},n.newOptionCreate=function(){var t=n.newOptionTitle.trim();t&&(n.ajaxLoadingSpinner++,o.post(n.poll._id,t).then(function(t){c(),n.newOptionTitle="",n.view="poll"}).catch(function(n){l.alert(n)}).finally(function(){n.ajaxLoadingSpinner--}))},n.optionVote=function(t){n.ajaxLoadingSpinner++,o.put(n.poll._id,t._id).then(function(n){c()}).catch(function(n){l.alert(n)}).finally(function(){n.ajaxLoadingSpinner--})}}])}();